#!/bin/sh
# Usage: approve-all [parallel-count]

# Abort on every error.
set -e

# Start that many jobs in parallel.
PARALLEL=$(expr "$1" \| 10)

# Get directory from config file
DIR=$(get-netspoc-approve-conf netspocdir)
cd $DIR/current/code

for device in * ; do
    case $device in *.raw) continue;; esac
    echo diamonds approve --brief $device
done | start-jobs -q $PARALLEL
