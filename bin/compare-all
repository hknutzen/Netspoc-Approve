#!/bin/sh
# Usage: compare-all [parallel-count]

# Abort on every error.
set -e

# Start that many jobs in parallel.
PARALLEL=$(expr "$1" \| 40)

# Get directory from config file
DIR=$(get-netspoc-approve-conf netspocdir)
cd $DIR/current/code

for device in * ; do
    case $device in *.*|\*) continue;; esac
    echo diamonds compare --brief $device
done | start-jobs -q $PARALLEL
