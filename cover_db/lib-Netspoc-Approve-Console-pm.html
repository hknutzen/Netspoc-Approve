<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.23
Devel::Cover is copyright 2001-2012, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: lib/Netspoc/Approve/Console.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">lib/Netspoc/Approve/Console.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">15.7%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td colspan="6"></td></tr><tr><td class="h">2 - 27</td><td colspan="5"></td><td class="s"><pre>=head1 DESCRIPTION

Manage connection to device.

=head1 COPYRIGHT AND DISCLAIMER

https://github.com/hknutzen/Netspoc-Approve
(c) 2014 by Heinz Knutzen &lt;heinz.knutzen@gmail.com&gt;
(c) 2008 by Daniel Brunkhorst &lt;daniel.brunkhorst@web.de&gt;
(c) 2007 by Arne Spetzler

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&nbsp;&nbsp;See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License along
with this program; if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

=cut</pre></td></tr>
<tr><td class="h">28</td><td colspan="6"></td></tr><tr><td class="h">29</td><td></td><td></td><td></td><td></td><td></td><td class="s">package Netspoc::Approve::Console;</td></tr>
<tr><td class="h">30</td><td colspan="6"></td></tr><tr><td class="h">31</td><td><div class="c3">76</div><div class="c3">76</div><div class="c3">76</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L31">76</a></div></td><td><div>267</div><div>81</div><div>1498</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">32</td><td><div class="c3">76</div><div class="c3">76</div><div class="c3">76</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L32">76</a></div></td><td><div>270</div><div>371</div><div>1526</div></td><td class="s">use warnings;</td></tr>
<tr><td class="h">33</td><td><div class="c3">76</div><div class="c3">76</div><div class="c3">76</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L33">76</a></div></td><td><div>328</div><div>84</div><div>5140</div></td><td class="s">use Netspoc::Approve::Helper;</td></tr>
<tr><td class="h">34</td><td><div class="c3">76</div><div class="c3">76</div><div class="c3">76</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L34">76</a></div></td><td><div>35430</div><div>2065782</div><div>53526</div></td><td class="s">use Expect;</td></tr>
<tr><td class="h">35</td><td></td><td></td><td></td><td></td><td></td><td class="s">require Exporter;</td></tr>
<tr><td class="h">36</td><td colspan="6"></td></tr><tr><td class="h">37</td><td></td><td></td><td></td><td></td><td></td><td class="s"># VERSION: inserted by DZP::OurPkgVersion</td></tr>
<tr><td class="h">38</td><td colspan="6"></td></tr><tr><td class="h">39</td><td></td><td></td><td></td><td></td><td></td><td class="s">our @ISA = qw(Exporter);</td></tr>
<tr><td class="h">40</td><td></td><td></td><td></td><td></td><td></td><td class="s">our @EXPORT = qw( open_con close_con&nbsp;&nbsp;);</td></tr>
<tr><td class="h">41</td><td colspan="6"></td></tr><tr><td class="h">42</td><td></td><td></td><td></td><td></td><td></td><td class="s">############################################################</td></tr>
<tr><td class="h">43</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Constructor.</td></tr>
<tr><td class="h">44</td><td></td><td></td><td></td><td></td><td></td><td class="s">############################################################</td></tr>
<tr><td class="h">45</td><td colspan="6"></td></tr><tr><td class="h">46</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub new_console {</td></tr>
<tr><td class="h">47</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L47">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($class) = @_;</td></tr>
<tr><td class="h">48</td><td colspan="6"></td></tr><tr><td class="h">49</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $con = {};</td></tr>
<tr><td class="h">50</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;bless( $con, $class );</td></tr>
<tr><td class="h">51</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $console = $con-&gt;{EXPECT} = Expect-&gt;new();</td></tr>
<tr><td class="h">52</td><td colspan="6"></td></tr><tr><td class="h">53</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$console-&gt;debug( 0 );</td></tr>
<tr><td class="h">54</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$console-&gt;exp_internal( 0 );</td></tr>
<tr><td class="h">55</td><td colspan="6"></td></tr><tr><td class="h">56</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#$Expect::Debug = 1;</td></tr>
<tr><td class="h">57</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$console-&gt;raw_pty( 1 );</td></tr>
<tr><td class="h">58</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$console-&gt;log_stdout( 0 );</td></tr>
<tr><td class="h">59</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $con;</td></tr>
<tr><td class="h">60</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">61</td><td colspan="6"></td></tr><tr><td class="h">62</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Set or change logfile for Expect.</td></tr>
<tr><td class="h">63</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub set_logfile {</td></tr>
<tr><td class="h">64</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L64">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($con, $logfile) = @_;</td></tr>
<tr><td class="h">65</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $console = $con-&gt;{EXPECT};</td></tr>
<tr><td class="h">66</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$console-&gt;log_file($logfile);</td></tr>
<tr><td class="h">67</td><td colspan="6"></td></tr><tr><td class="h">68</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Chmod, to allow read access by others.</td></tr>
<tr><td class="h">69</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="lib-Netspoc-Approve-Console-pm--branch.html#L69">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;defined chmod(0644, $logfile)</td></tr>
<tr><td class="h">70</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or abort(&quot;Couldn&#39;t chmod $logfile: $!&quot;);</td></tr>
<tr><td class="h">71</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">72</td><td colspan="6"></td></tr><tr><td class="h">73</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Print to logfile</td></tr>
<tr><td class="h">74</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub print_logfile {</td></tr>
<tr><td class="h">75</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L75">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($con, @strings) = @_;</td></tr>
<tr><td class="h">76</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $console = $con-&gt;{EXPECT};</td></tr>
<tr><td class="h">77</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$console-&gt;print_log_file(@strings);</td></tr>
<tr><td class="h">78</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">79</td><td colspan="6"></td></tr><tr><td class="h">80</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;If called in an array context expect() will return</td></tr>
<tr><td class="h">81</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;($matched_pattern_position, $error, $success-</td></tr>
<tr><td class="h">82</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;fully_matching_string, $before_match, and</td></tr>
<tr><td class="h">83</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;$after_match).</td></tr>
<tr><td class="h">84</td><td colspan="6"></td></tr><tr><td class="h">85</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;Possible values of $error are undef, indi-</td></tr>
<tr><td class="h">86</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;cating no error, &#39;1:TIMEOUT&#39; indicating that $timeout</td></tr>
<tr><td class="h">87</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;seconds had elapsed without a match, &#39;2:EOF&#39; indicat-</td></tr>
<tr><td class="h">88</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;ing an eof was read from $object, &#39;3: spawn</td></tr>
<tr><td class="h">89</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;id($fileno) died&#39; indicating that the process exited</td></tr>
<tr><td class="h">90</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;before matching and &#39;4:$!&#39; indicating whatever error</td></tr>
<tr><td class="h">91</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;was set in $ERRNO during the last read on $object&#39;s</td></tr>
<tr><td class="h">92</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;handle.</td></tr>
<tr><td class="h">93</td><td colspan="6"></td></tr><tr><td class="h">94</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub con_wait0 {</td></tr>
<tr><td class="h">95</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L95">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($con, $prompt, $timeout) = @_;</td></tr>
<tr><td class="h">96</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $exp = $con-&gt;{EXPECT};</td></tr>
<tr><td class="h">97</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($pos, $err, $match, $before, $after)</td></tr>
<tr><td class="h">98</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= $exp-&gt;expect( $timeout, &#39;-re&#39;, $prompt );</td></tr>
<tr><td class="h">99</td><td colspan="6"></td></tr><tr><td class="h">100</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $result = $con-&gt;{RESULT} = {</td></tr>
<tr><td class="h">101</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPPOS =&gt; $pos,</td></tr>
<tr><td class="h">102</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ERROR =&gt; $err,</td></tr>
<tr><td class="h">103</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATCH =&gt; $match,</td></tr>
<tr><td class="h">104</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEFORE =&gt; $before,</td></tr>
<tr><td class="h">105</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AFTER =&gt; $after,</td></tr>
<tr><td class="h">106</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">107</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $result;</td></tr>
<tr><td class="h">108</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">109</td><td colspan="6"></td></tr><tr><td class="h">110</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub con_wait {</td></tr>
<tr><td class="h">111</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L111">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($con, $prompt) = @_;</td></tr>
<tr><td class="h">112</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $timeout = $con-&gt;{TIMEOUT};</td></tr>
<tr><td class="h">113</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $result = $con-&gt;con_wait0($prompt, $timeout);</td></tr>
<tr><td class="h">114</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="lib-Netspoc-Approve-Console-pm--branch.html#L114">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$con-&gt;con_error() if $result-&gt;{ERROR};</td></tr>
<tr><td class="h">115</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $result;</td></tr>
<tr><td class="h">116</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">117</td><td colspan="6"></td></tr><tr><td class="h">118</td><td></td><td></td><td></td><td></td><td></td><td class="s"># We might accidently have read multiple prompt strings.</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This occurs, if reload banner is sent or multiple commands are sent in </td></tr>
<tr><td class="h">120</td><td></td><td></td><td></td><td></td><td></td><td class="s"># one packet.</td></tr>
<tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Check for this case and put extra data after first prompt back into</td></tr>
<tr><td class="h">122</td><td></td><td></td><td></td><td></td><td></td><td class="s"># accumulator of expect.</td></tr>
<tr><td class="h">123</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub con_wait_prompt1 {</td></tr>
<tr><td class="h">124</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L124">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($con, $prompt) = @_;</td></tr>
<tr><td class="h">125</td><td colspan="6"></td></tr><tr><td class="h">126</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$con-&gt;con_wait($prompt);</td></tr>
<tr><td class="h">127</td><td colspan="6"></td></tr><tr><td class="h">128</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Prompt was found.</td></tr>
<tr><td class="h">129</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Check for multiple prompts, find first one.</td></tr>
<tr><td class="h">130</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $result = $con-&gt;{RESULT};</td></tr>
<tr><td class="h">131</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $exp = $con-&gt;{EXPECT};</td></tr>
<tr><td class="h">132</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="lib-Netspoc-Approve-Console-pm--branch.html#L132">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($result-&gt;{BEFORE} =~ /^(.*?)($prompt)(.*)$/) {</td></tr>
<tr><td class="h">133</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug(&quot;Found multiple prompts&quot;);</td></tr>
<tr><td class="h">134</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug(&quot;Before: $1&quot;);</td></tr>
<tr><td class="h">135</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;{BEFORE} = $1;</td></tr>
<tr><td class="h">136</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $accum = $3 . $result-&gt;{MATCH} . $exp-&gt;clear_accum();</td></tr>
<tr><td class="h">137</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$exp-&gt;set_accum($accum);</td></tr>
<tr><td class="h">138</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug(&quot;Put back: $accum&quot;);</td></tr>
<tr><td class="h">139</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result-&gt;{MATCH} = $2;</td></tr>
<tr><td class="h">140</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">141</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">142</td><td colspan="6"></td></tr><tr><td class="h">143</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub con_short_wait {</td></tr>
<tr><td class="h">144</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L144">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($con, $prompt) = @_;</td></tr>
<tr><td class="h">145</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $timeout = $con-&gt;{LOGIN_TIMEOUT};</td></tr>
<tr><td class="h">146</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $con-&gt;con_wait0($prompt, $timeout);</td></tr>
<tr><td class="h">147</td><td></td><td></td><td></td><td></td><td></td><td class="s">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td class="h">148</td><td colspan="6"></td></tr><tr><td class="h">149</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub con_send_cmd {</td></tr>
<tr><td class="h">150</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L150">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($con, $cmd) = @_;</td></tr>
<tr><td class="h">151</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$con-&gt;{EXPECT}-&gt;send( $cmd );</td></tr>
<tr><td class="h">152</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">153</td><td colspan="6"></td></tr><tr><td class="h">154</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub con_issue_cmd {</td></tr>
<tr><td class="h">155</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L155">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($con, $cmd, $prompt, $check_prompt1) = @_;</td></tr>
<tr><td class="h">156</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$con-&gt;con_send_cmd(&quot;$cmd\n&quot;);</td></tr>
<tr><td class="h">157</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="lib-Netspoc-Approve-Console-pm--branch.html#L157">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$check_prompt1 </td></tr>
<tr><td class="h">158</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;? $con-&gt;con_wait_prompt1($prompt) </td></tr>
<tr><td class="h">159</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: $con-&gt;con_wait( $prompt );</td></tr>
<tr><td class="h">160</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">161</td><td colspan="6"></td></tr><tr><td class="h">162</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub con_error {</td></tr>
<tr><td class="h">163</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Console-pm--subroutine.html#L163">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($con) = @_;</td></tr>
<tr><td class="h">164</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $result = $con-&gt;{RESULT};</td></tr>
<tr><td class="h">165</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $err = $result-&gt;{ERROR};</td></tr>
<tr><td class="h">166</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="lib-Netspoc-Approve-Console-pm--branch.html#L166">0</a></div><div class="c0" title="-/-"><a href="lib-Netspoc-Approve-Console-pm--branch.html#L166">0</a></div><div class="c0" title="-/-"><a href="lib-Netspoc-Approve-Console-pm--branch.html#L166">0</a></div><div class="c0" title="-/-"><a href="lib-Netspoc-Approve-Console-pm--branch.html#L166">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($err =~ /^1:/) {</td></tr>
<tr><td class="h">167</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$err = &#39;TIMEOUT&#39;;</td></tr>
<tr><td class="h">168</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">169</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ($err =~ /^2:/) {</td></tr>
<tr><td class="h">170</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$err = &#39;Got EOF&#39;;</td></tr>
<tr><td class="h">171</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">172</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ($err =~ /^3:/) {</td></tr>
<tr><td class="h">173</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$err = &#39;Process died&#39;;</td></tr>
<tr><td class="h">174</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">175</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;elsif ($err =~ /^4:(.*)/) {</td></tr>
<tr><td class="h">176</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$err = $1;</td></tr>
<tr><td class="h">177</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">178</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @lines = ($err);</td></tr>
<tr><td class="h">179</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $key (qw(BEFORE AFTER)) {</td></tr>
<tr><td class="h">180</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="lib-Netspoc-Approve-Console-pm--branch.html#L180">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $value = $result-&gt;{$key} or next;</td></tr>
<tr><td class="h">181</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @lines, split /\n/, $value;</td></tr>
<tr><td class="h">182</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">183</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;abort(@lines);</td></tr>
<tr><td class="h">184</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">185</td><td colspan="6"></td></tr><tr><td class="h">186</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Modules must return a true value.</td></tr>
<tr><td class="h">187</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
