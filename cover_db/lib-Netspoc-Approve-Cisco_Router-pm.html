<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.23
Devel::Cover is copyright 2001-2012, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: lib/Netspoc/Approve/Cisco_Router.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">lib/Netspoc/Approve/Cisco_Router.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c2">92.4%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td colspan="6"></td></tr><tr><td class="h">2 - 26</td><td colspan="5"></td><td class="s"><pre>=head1 DESCRIPTION

Base class for Cisco routers (IOS, NX-OS)

=head1 COPYRIGHT AND DISCLAIMER

https://github.com/hknutzen/Netspoc-Approve
(c) 2016 by Heinz Knutzen &lt;heinz.knutzen@gmail.com&gt;
(c) 2011 by Daniel Brunkhorst &lt;daniel.brunkhorst@web.de&gt;

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&nbsp;&nbsp;See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License along
with this program; if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

=cut</pre></td></tr>
<tr><td class="h">27</td><td colspan="6"></td></tr><tr><td class="h">28</td><td></td><td></td><td></td><td></td><td></td><td class="s">package Netspoc::Approve::Cisco_Router;</td></tr>
<tr><td class="h">29</td><td colspan="6"></td></tr><tr><td class="h">30</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Authors: Heinz Knutzen</td></tr>
<tr><td class="h">31</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">32</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Description:</td></tr>
<tr><td class="h">33</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Base class for Cisco routers (IOS, NX-OS)</td></tr>
<tr><td class="h">34</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">35</td><td colspan="6"></td></tr><tr><td class="h">36</td><td></td><td></td><td></td><td></td><td></td><td class="s"># VERSION: inserted by DZP::OurPkgVersion</td></tr>
<tr><td class="h">37</td><td colspan="6"></td></tr><tr><td class="h">38</td><td><div class="c3">76</div><div class="c3">76</div><div class="c3">76</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L38">76</a></div></td><td><div>301</div><div>87</div><div>23064</div></td><td class="s">use base &quot;Netspoc::Approve::Cisco&quot;;</td></tr>
<tr><td class="h">39</td><td><div class="c3">76</div><div class="c3">76</div><div class="c3">76</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L39">76</a></div></td><td><div>308</div><div>73</div><div>1232</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">40</td><td><div class="c3">76</div><div class="c3">76</div><div class="c3">76</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L40">76</a></div></td><td><div>272</div><div>74</div><div>1464</div></td><td class="s">use warnings;</td></tr>
<tr><td class="h">41</td><td><div class="c3">76</div><div class="c3">76</div><div class="c3">76</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L41">76</a></div></td><td><div>275</div><div>73</div><div>138311</div></td><td class="s">use Netspoc::Approve::Helper;</td></tr>
<tr><td class="h">42</td><td colspan="6"></td></tr><tr><td class="h">43</td><td colspan="6"></td></tr><tr><td class="h">44</td><td></td><td></td><td></td><td></td><td></td><td class="s"># ACL line numbers don&#39;t change during incremental ACL update.</td></tr>
<tr><td class="h">45</td><td></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L45">38</a></div></td><td></td><td class="s">sub change_acl_numbers {}</td></tr>
<tr><td class="h">46</td><td colspan="6"></td></tr><tr><td class="h">47</td><td></td><td></td><td></td><td></td><td></td><td class="s"># ACL lines start at 10000, increment by 10000.</td></tr>
<tr><td class="h">48</td><td></td><td></td><td></td><td></td><td></td><td class="s"># When adding lines in front of some line n</td></tr>
<tr><td class="h">49</td><td></td><td></td><td></td><td></td><td></td><td class="s"># start at n-9999 and subsequent lines at n-9999+1, n-9999+1+1, ...</td></tr>
<tr><td class="h">50</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub ACL_line_discipline {</td></tr>
<tr><td class="h">51</td><td><div class="c3">72</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L51">72</a></div></td><td><div>124</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return (10000, 10000, -9999, 1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td class="h">52</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">53</td><td colspan="6"></td></tr><tr><td class="h">54</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mark_unneeded_object_group_from_acl {</td></tr>
<tr><td class="h">55</td><td><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L55">4</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $acl) = @_;</td></tr>
<tr><td class="h">56</td><td><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td></td><td><div>6</div><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $entry (@{ $acl-&gt;{LIST} }) {</td></tr>
<tr><td class="h">57</td><td><div class="c3">15</div></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;mark_unneeded_object_group_from_acl_entry($entry);</td></tr>
<tr><td class="h">58</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">59</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">60</td><td colspan="6"></td></tr><tr><td class="h">61</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mark_unneeded_object_group_from_acl_entry {</td></tr>
<tr><td class="h">62</td><td><div class="c3">33</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L62">33</a></div></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $entry) = @_;</td></tr>
<tr><td class="h">63</td><td><div class="c3">33</div></td><td></td><td></td><td></td><td><div>45</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $where (qw(TYPE SRC DST SRC_PORT DST_PORT)) {</td></tr>
<tr><td class="h">64</td><td><div class="c3">165</div></td><td></td><td></td><td></td><td><div>155</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $what = $entry-&gt;{$where};</td></tr>
<tr><td class="h">65</td><td><div class="c3">165</div></td><td><div class="c0" title="-/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L65">50</a></div></td><td><div class="c0"><a href="lib-Netspoc-Approve-Cisco_Router-pm--condition.html#L65">67</a></div></td><td></td><td><div>430</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(my $group = ref($what) &amp;&amp; $what-&gt;{GROUP}) {</td></tr>
<tr><td class="h">66</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L66">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!$group-&gt;{needed}) {</td></tr>
<tr><td class="h">67</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$group-&gt;{remove} = 1;</td></tr>
<tr><td class="h">68</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">69</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">70</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">71</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">72</td><td colspan="6"></td></tr><tr><td class="h">73</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Defines new ACL.</td></tr>
<tr><td class="h">74</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Assumes that conf mode is already enabled</td></tr>
<tr><td class="h">75</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub define_acl {</td></tr>
<tr><td class="h">76</td><td><div class="c3">7</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L76">7</a></div></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $conf, $spoc, $spoc_name) = @_;</td></tr>
<tr><td class="h">77</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $spoc_acl = $spoc-&gt;{ACCESS_LIST}-&gt;{$spoc_name};</td></tr>
<tr><td class="h">78</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $entries = $spoc_acl-&gt;{LIST};</td></tr>
<tr><td class="h">79</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $name = $self-&gt;generate_name_for_transfer($spoc_name, </td></tr>
<tr><td class="h">80</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conf-&gt;{ACCESS_LIST});</td></tr>
<tr><td class="h">81</td><td><div class="c3">7</div></td><td><div class="c0" title="T/-"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L81">50</a></div></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (my $cmd = $spoc_acl-&gt;{orig}) {</td></tr>
<tr><td class="h">82</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>104</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd =~ s/$spoc_name\s*/$name/;</td></tr>
<tr><td class="h">83</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd($cmd);</td></tr>
<tr><td class="h">84</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">85</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $entry (@$entries) {</td></tr>
<tr><td class="h">86</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td><div>56</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $subcmd = $self-&gt;subst_ace_name_og($entry, $name);</td></tr>
<tr><td class="h">87</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td><div>56</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd($subcmd);</td></tr>
<tr><td class="h">88</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">89</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $name;</td></tr>
<tr><td class="h">90</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">91</td><td colspan="6"></td></tr><tr><td class="h">92</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub modify_object_groups {</td></tr>
<tr><td class="h">93</td><td><div class="c3">36</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L93">36</a></div></td><td><div>49</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $conf, $spoc) = @_;</td></tr>
<tr><td class="h">94</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>48</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $hash = $spoc-&gt;{OBJECT_GROUP};</td></tr>
<tr><td class="h">95</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>129</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $name (sort keys %$hash) {</td></tr>
<tr><td class="h">96</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $group = $hash-&gt;{$name};</td></tr>
<tr><td class="h">97</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $add = $group-&gt;{add_entries};</td></tr>
<tr><td class="h">98</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $del = $group-&gt;{del_entries};</td></tr>
<tr><td class="h">99</td><td><div class="c3">3</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L99">100</a></div></td><td><div class="c0"><a href="lib-Netspoc-Approve-Cisco_Router-pm--condition.html#L99">67</a></div></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($add || $del) or next;</td></tr>
<tr><td class="h">100</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>1</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $dev_name = $group-&gt;{name_on_dev};</td></tr>
<tr><td class="h">101</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cmd = $group-&gt;{orig};</td></tr>
<tr><td class="h">102</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd =~ s/ $name $ /$dev_name/x;</td></tr>
<tr><td class="h">103</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd($cmd);</td></tr>
<tr><td class="h">104</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L104">50</a></div></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($add) {</td></tr>
<tr><td class="h">105</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map( { $self-&gt;cmd( $_-&gt;{orig} ) } @$add );</td></tr>
<tr><td class="h">106</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">107</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L107">50</a></div></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($del) {</td></tr>
<tr><td class="h">108</td><td><div class="c3">1</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>2</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map( { $self-&gt;cmd( &quot;no $_-&gt;{orig}&quot; ) } @$del );</td></tr>
<tr><td class="h">109</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">110</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">111</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">112</td><td colspan="6"></td></tr><tr><td class="h">113</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Generate new name for transfer:</td></tr>
<tr><td class="h">114</td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;spoc-name&gt;-DRC-&lt;index&gt;</td></tr>
<tr><td class="h">115</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub generate_name_for_transfer {</td></tr>
<tr><td class="h">116</td><td><div class="c3">8</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L116">8</a></div></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $name, $objects) = @_;</td></tr>
<tr><td class="h">117</td><td><div class="c3">8</div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $prefix = &quot;$name-DRC-&quot;;</td></tr>
<tr><td class="h">118</td><td><div class="c3">8</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $index&nbsp;&nbsp;= 0;</td></tr>
<tr><td class="h">119</td><td><div class="c3">8</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $new;</td></tr>
<tr><td class="h">120</td><td><div class="c3">8</div></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while ($new = &quot;$prefix$index&quot;, $objects-&gt;{$new}) {</td></tr>
<tr><td class="h">121</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$index++;</td></tr>
<tr><td class="h">122</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">123</td><td><div class="c3">8</div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $new;</td></tr>
<tr><td class="h">124</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">125</td><td colspan="6"></td></tr><tr><td class="h">126</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub transfer_object_groups {</td></tr>
<tr><td class="h">127</td><td><div class="c3">36</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L127">36</a></div></td><td><div>52</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $conf, $spoc) = @_;</td></tr>
<tr><td class="h">128</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>51</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $conf_groups = $conf-&gt;{OBJECT_GROUP};</td></tr>
<tr><td class="h">129</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $spoc_groups = $spoc-&gt;{OBJECT_GROUP};</td></tr>
<tr><td class="h">130</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>94</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $name (sort keys %$spoc_groups) {</td></tr>
<tr><td class="h">131</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $group = $spoc_groups-&gt;{$name};</td></tr>
<tr><td class="h">132</td><td><div class="c3">3</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L132">100</a></div></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$group-&gt;{transfer} or next;</td></tr>
<tr><td class="h">133</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $new_name = $group-&gt;{new_name} = </td></tr>
<tr><td class="h">134</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;generate_name_for_transfer($name, $conf_groups);</td></tr>
<tr><td class="h">135</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>1</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cmd = $group-&gt;{orig};</td></tr>
<tr><td class="h">136</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd =~ s/ $name $ /$new_name/x;</td></tr>
<tr><td class="h">137</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd($cmd);</td></tr>
<tr><td class="h">138</td><td><div class="c3">1</div><div class="c3">3</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>1</div><div>7</div><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map( { $self-&gt;cmd( $_-&gt;{orig} ) } @{ $group-&gt;{OBJECT} } );</td></tr>
<tr><td class="h">139</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">140</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">141</td><td colspan="6"></td></tr><tr><td class="h">142</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub remove_object_groups {</td></tr>
<tr><td class="h">143</td><td><div class="c3">36</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L143">36</a></div></td><td><div>51</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $conf, $spoc) = @_;</td></tr>
<tr><td class="h">144</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>47</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $conf_groups = $conf-&gt;{OBJECT_GROUP};</td></tr>
<tr><td class="h">145</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>110</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $name (sort keys %$conf_groups) {</td></tr>
<tr><td class="h">146</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $group = $conf_groups-&gt;{$name};</td></tr>
<tr><td class="h">147</td><td><div class="c3">2</div></td><td><div class="c0" title="-/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L147">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($group-&gt;{remove}) {</td></tr>
<tr><td class="h">148</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd(&quot;no $group-&gt;{orig}&quot;);</td></tr>
<tr><td class="h">149</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">150</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">151</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">152</td><td colspan="6"></td></tr><tr><td class="h">153</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub gen_ace_cmd {</td></tr>
<tr><td class="h">154</td><td><div class="c3">36</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L154">36</a></div></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $hash) = @_;</td></tr>
<tr><td class="h">155</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>36</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $line = $hash-&gt;{line};</td></tr>
<tr><td class="h">156</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>46</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cmd;</td></tr>
<tr><td class="h">157</td><td><div class="c3">36</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L157">100</a></div></td><td></td><td></td><td><div>61</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($hash-&gt;{delete}) {</td></tr>
<tr><td class="h">158</td><td><div class="c3">17</div></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd = &quot;no $line&quot;;</td></tr>
<tr><td class="h">159</td><td><div class="c3">17</div></td><td></td><td></td><td></td><td><div>50</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;mark_unneeded_object_group_from_acl_entry($hash-&gt;{ace});</td></tr>
<tr><td class="h">160</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">161</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">162</td><td><div class="c3">19</div></td><td></td><td></td><td></td><td><div>54</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd = $self-&gt;subst_ace_name_og($hash-&gt;{ace}, $hash-&gt;{name});</td></tr>
<tr><td class="h">163</td><td><div class="c3">19</div></td><td></td><td></td><td></td><td><div>43</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cmd = &quot;$line $cmd&quot;;</td></tr>
<tr><td class="h">164</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">165</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>50</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $cmd;</td></tr>
<tr><td class="h">166</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">167</td><td colspan="6"></td></tr><tr><td class="h">168</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub remove_acl {</td></tr>
<tr><td class="h">169</td><td><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L169">4</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $acl) = @_;</td></tr>
<tr><td class="h">170</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cmd = $acl-&gt;{orig};</td></tr>
<tr><td class="h">171</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd(&quot;no $cmd&quot;);</td></tr>
<tr><td class="h">172</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">173</td><td colspan="6"></td></tr><tr><td class="h">174</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub assign_acl {</td></tr>
<tr><td class="h">175</td><td><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L175">5</a></div></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $intf, $acl_name, $in_out) = @_;</td></tr>
<tr><td class="h">176</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $direction = lc($in_out);</td></tr>
<tr><td class="h">177</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd($intf-&gt;{orig});</td></tr>
<tr><td class="h">178</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd(&quot;ip access-group $acl_name $direction&quot;);</td></tr>
<tr><td class="h">179</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">180</td><td colspan="6"></td></tr><tr><td class="h">181</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub unassign_acl&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">182</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L182">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $intf, $acl_name, $in_out) = @_;</td></tr>
<tr><td class="h">183</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $direction = lc($in_out);</td></tr>
<tr><td class="h">184</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd($intf-&gt;{orig});</td></tr>
<tr><td class="h">185</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd(&quot;no ip access-group $acl_name $direction&quot;);</td></tr>
<tr><td class="h">186</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">187</td><td colspan="6"></td></tr><tr><td class="h">188</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub process_interface_acls {</td></tr>
<tr><td class="h">189</td><td><div class="c3">31</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L189">31</a></div></td><td><div>48</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $conf, $spoc) = @_;</td></tr>
<tr><td class="h">190</td><td colspan="6"></td></tr><tr><td class="h">191</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>128</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;enter_conf_mode(&#39;session&#39;);</td></tr>
<tr><td class="h">192</td><td colspan="6"></td></tr><tr><td class="h">193</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Collect list of interface pairs.</td></tr>
<tr><td class="h">194</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>31</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @interface_pairs;</td></tr>
<tr><td class="h">195</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>48</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $spoc_interfaces = $spoc-&gt;{IF};</td></tr>
<tr><td class="h">196</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $conf_interfaces = $conf-&gt;{IF};</td></tr>
<tr><td class="h">197</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>78</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $name (sort keys %$spoc_interfaces){</td></tr>
<tr><td class="h">198</td><td><div class="c3">34</div></td><td><div class="c0" title="-/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L198">50</a></div></td><td></td><td></td><td><div>89</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $conf_intf = $conf_interfaces-&gt;{$name} or internal_err;</td></tr>
<tr><td class="h">199</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $spoc_intf = $spoc_interfaces-&gt;{$name};</td></tr>
<tr><td class="h">200</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td><div>77</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @interface_pairs, [ $conf_intf, $spoc_intf ];</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">202</td><td colspan="6"></td></tr><tr><td class="h">203</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Analyze changes in all ACLs bound to interfaces.</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Try to change ACLs incrementally.</td></tr>
<tr><td class="h">205</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Get list of ACL pairs, that need to be redefined, added or removed.</td></tr>
<tr><td class="h">206</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>142</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @acl_update_info = </td></tr>
<tr><td class="h">207</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;equalize_acls_of_objects($conf, $spoc, \@interface_pairs);</td></tr>
<tr><td class="h">208</td><td colspan="6"></td></tr><tr><td class="h">209</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>50</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $info (@acl_update_info) {</td></tr>
<tr><td class="h">210</td><td><div class="c3">46</div></td><td></td><td></td><td></td><td><div>86</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($intf, $in_out, $conf_acl, $spoc_acl) = @$info;</td></tr>
<tr><td class="h">211</td><td><div class="c3">46</div></td><td></td><td></td><td></td><td><div>70</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{CHANGE}-&gt;{ACCESS_LIST} = 1;</td></tr>
<tr><td class="h">212</td><td colspan="6"></td></tr><tr><td class="h">213</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Add ACL to device.</td></tr>
<tr><td class="h">214</td><td><div class="c3">46</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L214">100</a></div></td><td></td><td></td><td><div>86</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($spoc_acl) {</td></tr>
<tr><td class="h">215</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;schedule_reload(5);</td></tr>
<tr><td class="h">216</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $aclname = $self-&gt;define_acl($conf, $spoc, $spoc_acl-&gt;{name});</td></tr>
<tr><td class="h">217</td><td colspan="6"></td></tr><tr><td class="h">218</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Assign new acl to interface.</td></tr>
<tr><td class="h">219</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;assign_acl($intf, $aclname, $in_out);</td></tr>
<tr><td class="h">220</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cancel_reload();</td></tr>
<tr><td class="h">221</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">222</td><td colspan="6"></td></tr><tr><td class="h">223</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Remove ACL from device.</td></tr>
<tr><td class="h">224</td><td><div class="c3">46</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L224">100</a></div></td><td></td><td></td><td><div>105</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($conf_acl) {</td></tr>
<tr><td class="h">225</td><td><div class="c3">2</div></td><td><div class="c0" title="-/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L225">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (not $spoc_acl) {</td></tr>
<tr><td class="h">226</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;unassign_acl($intf, $conf_acl-&gt;{name}, $in_out);</td></tr>
<tr><td class="h">227</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">228</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;remove_acl($conf_acl);</td></tr>
<tr><td class="h">229</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">230</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">231</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>119</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;leave_conf_mode();</td></tr>
<tr><td class="h">232</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">233</td><td colspan="6"></td></tr><tr><td class="h">234</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Equalize ACLs for list of interface pairs or list of crypto map pairs.</td></tr>
<tr><td class="h">235</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub equalize_acls_of_objects {</td></tr>
<tr><td class="h">236</td><td><div class="c3">36</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L236">36</a></div></td><td><div>55</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $conf, $spoc, $object_pairs) = @_;</td></tr>
<tr><td class="h">237</td><td colspan="6"></td></tr><tr><td class="h">238</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Collect list of info </td></tr>
<tr><td class="h">239</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# [interface/crypto_entry, in/out, conf_acl, spoc_acl], </td></tr>
<tr><td class="h">240</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# about ACL pairs that need to be transferred and/or removed.</td></tr>
<tr><td class="h">241</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @acl_update_info;</td></tr>
<tr><td class="h">242</td><td colspan="6"></td></tr><tr><td class="h">243</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %acl_ready;</td></tr>
<tr><td class="h">244</td><td colspan="6"></td></tr><tr><td class="h">245</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Pass 1: Equalize object groups of matching ACL lines.</td></tr>
<tr><td class="h">246</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $pair (@$object_pairs){</td></tr>
<tr><td class="h">247</td><td><div class="c3">39</div></td><td></td><td></td><td></td><td><div>54</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($conf_obj, $spoc_obj) = @$pair;</td></tr>
<tr><td class="h">248</td><td><div class="c3">39</div></td><td></td><td></td><td></td><td><div>53</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $in_out (qw(IN OUT)) {</td></tr>
<tr><td class="h">249</td><td><div class="c3">78</div></td><td></td><td></td><td></td><td><div>105</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $direction = lc($in_out);</td></tr>
<tr><td class="h">250</td><td><div class="c3">78</div></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--condition.html#L250">100</a></div></td><td></td><td><div>270</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $confacl_name = $conf_obj-&gt;{&quot;ACCESS_GROUP_$in_out&quot;} || &#39;&#39;;</td></tr>
<tr><td class="h">251</td><td><div class="c3">78</div></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--condition.html#L251">100</a></div></td><td></td><td><div>232</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $spocacl_name = $spoc_obj-&gt;{&quot;ACCESS_GROUP_$in_out&quot;} || &#39;&#39;;</td></tr>
<tr><td class="h">252</td><td><div class="c3">78</div></td><td></td><td></td><td></td><td><div>100</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $conf_acl = $conf-&gt;{ACCESS_LIST}-&gt;{$confacl_name};</td></tr>
<tr><td class="h">253</td><td><div class="c3">78</div></td><td></td><td></td><td></td><td><div>81</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $spoc_acl = $spoc-&gt;{ACCESS_LIST}-&gt;{$spocacl_name};</td></tr>
<tr><td class="h">254</td><td colspan="6"></td></tr><tr><td class="h">255</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Try to change objects groups of existing ACL on device.</td></tr>
<tr><td class="h">256</td><td><div class="c3">78</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L256">100</a></div><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L256">100</a></div></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--condition.html#L256">100</a></div></td><td></td><td><div>321</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($conf_acl and $spoc_acl) {</td></tr>
<tr><td class="h">257</td><td><div class="c3">28</div></td><td></td><td></td><td></td><td><div>119</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ready = $self-&gt;equalize_acl_groups($conf_acl, $spoc_acl);</td></tr>
<tr><td class="h">258</td><td><div class="c3">28</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L258">100</a></div></td><td></td><td></td><td><div>70</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($ready) {</td></tr>
<tr><td class="h">259</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$acl_ready{$spoc_acl} = 1;</td></tr>
<tr><td class="h">260</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">261</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">262</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">263</td><td colspan="6"></td></tr><tr><td class="h">264</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ACL from netspoc will be transferred.</td></tr>
<tr><td class="h">265</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Mark referenced object groups.</td></tr>
<tr><td class="h">266</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ($spoc_acl) {</td></tr>
<tr><td class="h">267</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;mark_object_group_from_acl($spoc_acl);</td></tr>
<tr><td class="h">268</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td class="h">269</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">270</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">271</td><td colspan="6"></td></tr><tr><td class="h">272</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>126</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;modify_object_groups($conf, $spoc);</td></tr>
<tr><td class="h">273</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>122</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;transfer_object_groups($conf, $spoc);</td></tr>
<tr><td class="h">274</td><td colspan="6"></td></tr><tr><td class="h">275</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Pass 2: Try to equalize ACLs by incremental changes to ACL on device.</td></tr>
<tr><td class="h">276</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>107</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($line_start, $line_incr) = $self-&gt;ACL_line_discipline();</td></tr>
<tr><td class="h">277</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>73</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{CHANGE}-&gt;{ACCESS_LIST} = 0;</td></tr>
<tr><td class="h">278</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>62</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $pair (@$object_pairs){</td></tr>
<tr><td class="h">279</td><td><div class="c3">39</div></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($conf_obj, $spoc_obj) = @$pair;</td></tr>
<tr><td class="h">280</td><td><div class="c3">39</div></td><td></td><td></td><td></td><td><div>49</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $in_out (qw(IN OUT)) {</td></tr>
<tr><td class="h">281</td><td><div class="c3">78</div></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--condition.html#L281">100</a></div></td><td></td><td><div>297</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $confacl_name = $conf_obj-&gt;{&quot;ACCESS_GROUP_$in_out&quot;} || &#39;&#39;;</td></tr>
<tr><td class="h">282</td><td><div class="c3">78</div></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--condition.html#L282">100</a></div></td><td></td><td><div>245</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $spocacl_name = $spoc_obj-&gt;{&quot;ACCESS_GROUP_$in_out&quot;} || &#39;&#39;;</td></tr>
<tr><td class="h">283</td><td><div class="c3">78</div></td><td></td><td></td><td></td><td><div>91</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $conf_acl = $conf-&gt;{ACCESS_LIST}-&gt;{$confacl_name};</td></tr>
<tr><td class="h">284</td><td><div class="c3">78</div></td><td></td><td></td><td></td><td><div>93</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $spoc_acl = $spoc-&gt;{ACCESS_LIST}-&gt;{$spocacl_name};</td></tr>
<tr><td class="h">285</td><td colspan="6"></td></tr><tr><td class="h">286</td><td><div class="c3">78</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L286">100</a></div></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--condition.html#L286">100</a></div></td><td></td><td><div>238</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($conf_acl and $spoc_acl) {</td></tr>
<tr><td class="h">287</td><td colspan="6"></td></tr><tr><td class="h">288</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# We already know from group compare, that ACL doesn&#39;t change.</td></tr>
<tr><td class="h">289</td><td><div class="c3">28</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L289">100</a></div></td><td></td><td></td><td><div>85</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $acl_ready{$spoc_acl};</td></tr>
<tr><td class="h">290</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td><div>64</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ready = $self-&gt;equalize_acl_entries($conf_acl, $spoc_acl);</td></tr>
<tr><td class="h">291</td><td colspan="6"></td></tr><tr><td class="h">292</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ACL remains unchanged. This can occur, if some group</td></tr>
<tr><td class="h">293</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# was recognized as unchanged later.</td></tr>
<tr><td class="h">294</td><td><div class="c3">14</div></td><td><div class="c0" title="-/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L294">50</a></div></td><td></td><td></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $ready;</td></tr>
<tr><td class="h">295</td><td colspan="6"></td></tr><tr><td class="h">296</td><td><div class="c3">14</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L296">100</a></div></td><td></td><td></td><td><div>33</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (my $vcmds = $spoc_acl-&gt;{modify_cmds} ) {</td></tr>
<tr><td class="h">297</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{CHANGE}-&gt;{ACCESS_LIST} = 1;</td></tr>
<tr><td class="h">298</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $acl_name = $conf_acl-&gt;{name};</td></tr>
<tr><td class="h">299</td><td colspan="6"></td></tr><tr><td class="h">300</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Change line numbers of ACL entries on device to the same</td></tr>
<tr><td class="h">301</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# values as used in ACL commands.</td></tr>
<tr><td class="h">302</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Do resequence before schedule reload, because it may</td></tr>
<tr><td class="h">303</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# abort if this command isn&#39;t available on old IOS version.</td></tr>
<tr><td class="h">304</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;resequence_cmd($acl_name, $line_start, $line_incr);</td></tr>
<tr><td class="h">305</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td><div>40</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;schedule_reload(5);</td></tr>
<tr><td class="h">306</td><td><div class="c3">11</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L306">100</a></div></td><td></td><td></td><td><div>33</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd($conf_acl-&gt;{orig}) if $conf_acl-&gt;{orig};</td></tr>
<tr><td class="h">307</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $vcmd (@$vcmds) {</td></tr>
<tr><td class="h">308</td><td><div class="c3">31</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L308">100</a></div></td><td></td><td></td><td><div>71</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ref $vcmd eq &#39;ARRAY&#39;) {</td></tr>
<tr><td class="h">309</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($vcmd1, $vcmd2) = @$vcmd;</td></tr>
<tr><td class="h">310</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cmd1 = $self-&gt;gen_ace_cmd($vcmd1);</td></tr>
<tr><td class="h">311</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cmd2 = $self-&gt;gen_ace_cmd($vcmd2);</td></tr>
<tr><td class="h">312</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;two_cmd($cmd1, $cmd2);</td></tr>
<tr><td class="h">313</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">314</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">315</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td><div>50</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cmd = $self-&gt;gen_ace_cmd($vcmd);</td></tr>
<tr><td class="h">316</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td><div>48</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cmd($cmd);</td></tr>
<tr><td class="h">317</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">318</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">319</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;cancel_reload();</td></tr>
<tr><td class="h">320</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;resequence_cmd($acl_name, 10, 10);</td></tr>
<tr><td class="h">321</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">322</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">323</td><td colspan="6"></td></tr><tr><td class="h">324</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# No modify_cmds: Fall through; add ACL.</td></tr>
<tr><td class="h">325</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">326</td><td colspan="6"></td></tr><tr><td class="h">327</td><td><div class="c3">53</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L327">100</a></div></td><td></td><td></td><td><div>91</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($spoc_acl) {</td></tr>
<tr><td class="h">328</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;mark_object_group_from_acl($spoc_acl);</td></tr>
<tr><td class="h">329</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">330</td><td><div class="c3">53</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L330">100</a></div></td><td></td><td></td><td><div>86</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($conf_acl) {</td></tr>
<tr><td class="h">331</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;mark_unneeded_object_group_from_acl($conf_acl);</td></tr>
<tr><td class="h">332</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">333</td><td colspan="6"></td></tr><tr><td class="h">334</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Collect pair for later processing.</td></tr>
<tr><td class="h">335</td><td><div class="c3">53</div></td><td></td><td></td><td></td><td><div>162</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @acl_update_info, [$conf_obj, lc($in_out), </td></tr>
<tr><td class="h">336</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conf_acl, $spoc_acl];</td></tr>
<tr><td class="h">337</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">338</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">339</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>118</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;remove_object_groups($conf, $spoc);</td></tr>
<tr><td class="h">340</td><td><div class="c3">36</div></td><td></td><td></td><td></td><td><div>91</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @acl_update_info;</td></tr>
<tr><td class="h">341</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">342</td><td colspan="6"></td></tr><tr><td class="h">343</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Check if mpls is enabled at one or more interfaces in any VRF.</td></tr>
<tr><td class="h">344</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub check_mpls {</td></tr>
<tr><td class="h">345</td><td><div class="c3">31</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L345">31</a></div></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $conf) = @_;</td></tr>
<tr><td class="h">346</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>45</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $intf_hash = $conf-&gt;{IF};</td></tr>
<tr><td class="h">347</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>63</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $intf (values %$intf_hash) {</td></tr>
<tr><td class="h">348</td><td><div class="c3">38</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L348">100</a></div></td><td></td><td></td><td><div>95</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $intf-&gt;{MPLS};</td></tr>
<tr><td class="h">349</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">350</td><td><div class="c3">30</div></td><td></td><td></td><td></td><td><div>48</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">351</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">352</td><td colspan="6"></td></tr><tr><td class="h">353</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Netspoc creates a single configuration file for a device </td></tr>
<tr><td class="h">354</td><td></td><td></td><td></td><td></td><td></td><td class="s"># having different VRFs.</td></tr>
<tr><td class="h">355</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Now remove that parts from the device configuration,</td></tr>
<tr><td class="h">356</td><td></td><td></td><td></td><td></td><td></td><td class="s"># which are related to a&nbsp;&nbsp;VRFs not managed by Netspoc.</td></tr>
<tr><td class="h">357</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This way, we leave unmanaged VRFs unchanged.</td></tr>
<tr><td class="h">358</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub align_vrfs {</td></tr>
<tr><td class="h">359</td><td><div class="c3">31</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L359">31</a></div></td><td><div>44</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $conf, $spoc) = @_;</td></tr>
<tr><td class="h">360</td><td colspan="6"></td></tr><tr><td class="h">361</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Find VRFs used in Netspoc configuration.</td></tr>
<tr><td class="h">362</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %spoc_vrf = </td></tr>
<tr><td class="h">363</td><td><div class="c3">49</div></td><td></td><td></td><td></td><td><div>108</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map({ $_ =&gt; 1 } </td></tr>
<tr><td class="h">364</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>169</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map($_-&gt;{VRF} || &#39;&#39;, values %{ $spoc-&gt;{IF} }),</td></tr>
<tr><td class="h">365</td><td><div class="c3">31</div><div class="c3">31</div></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--condition.html#L365">100</a></div></td><td></td><td><div>43</div><div>69</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keys %{ $spoc-&gt;{ROUTING_VRF} });</td></tr>
<tr><td class="h">366</td><td colspan="6"></td></tr><tr><td class="h">367</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Remove parts from unmanaged VRFs.</td></tr>
<tr><td class="h">368</td><td colspan="6"></td></tr><tr><td class="h">369</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Remove interfaces and referenced ACLs and object groups.</td></tr>
<tr><td class="h">370</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>46</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %removed;</td></tr>
<tr><td class="h">371</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>42</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $intf = $conf-&gt;{IF};</td></tr>
<tr><td class="h">372</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $name (keys %$intf) {</td></tr>
<tr><td class="h">373</td><td><div class="c3">38</div></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--condition.html#L373">100</a></div></td><td></td><td><div>126</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $vrf = $intf-&gt;{$name}-&gt;{VRF} || &#39;&#39;;</td></tr>
<tr><td class="h">374</td><td><div class="c3">38</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L374">100</a></div></td><td></td><td></td><td><div>90</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!$spoc_vrf{$vrf}) {</td></tr>
<tr><td class="h">375</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $intf-&gt;{$name};</td></tr>
<tr><td class="h">376</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$removed{$vrf} = 1;</td></tr>
<tr><td class="h">377</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">378</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">379</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>45</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $routing = $conf-&gt;{ROUTING_VRF};</td></tr>
<tr><td class="h">380</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>61</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $vrf (keys %$routing) {</td></tr>
<tr><td class="h">381</td><td><div class="c3">10</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L381">100</a></div></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!$spoc_vrf{$vrf}) {</td></tr>
<tr><td class="h">382</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $routing-&gt;{$vrf};</td></tr>
<tr><td class="h">383</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$removed{$vrf} = 1;</td></tr>
<tr><td class="h">384</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">385</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">386</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>61</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $vrf (sort keys %removed) {</td></tr>
<tr><td class="h">387</td><td><div class="c3">3</div></td><td></td><td><div class="c0"><a href="lib-Netspoc-Approve-Cisco_Router-pm--condition.html#L387">50</a></div></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$vrf ||= &#39;global&#39;;</td></tr>
<tr><td class="h">388</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;info(&quot;Leaving VRF $vrf untouched&quot;);</td></tr>
<tr><td class="h">389</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">390</td><td><div class="c3">31</div></td><td><div class="c3" title="T/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L390">100</a></div></td><td></td><td></td><td><div>102</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (keys %removed) {</td></tr>
<tr><td class="h">391</td><td><div class="c3">3</div><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="lib-Netspoc-Approve-Cisco_Router-pm--branch.html#L391">50</a></div></td><td></td><td></td><td><div>3</div><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keys %{ $spoc-&gt;{CRYPTO} } and </td></tr>
<tr><td class="h">392</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abort(&quot;Crypto and VRF can&#39;t be used together,&quot; .</td></tr>
<tr><td class="h">393</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot; if some VRF is unmanaged&quot;);</td></tr>
<tr><td class="h">394</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">395</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">396</td><td colspan="6"></td></tr><tr><td class="h">397</td><td colspan="6"></td></tr><tr><td class="h">398</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub transfer {</td></tr>
<tr><td class="h">399</td><td><div class="c3">31</div></td><td></td><td></td><td><div class="c3"><a href="lib-Netspoc-Approve-Cisco_Router-pm--subroutine.html#L399">31</a></div></td><td><div>42</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $conf, $spoc) = @_;</td></tr>
<tr><td class="h">400</td><td colspan="6"></td></tr><tr><td class="h">401</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Check if any interface has mpls enabled.</td></tr>
<tr><td class="h">402</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>160</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $has_mpls = $self-&gt;check_mpls($conf);</td></tr>
<tr><td class="h">403</td><td colspan="6"></td></tr><tr><td class="h">404</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Ignore unmanged VRFs of device.</td></tr>
<tr><td class="h">405</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>94</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;align_vrfs($conf, $spoc);</td></tr>
<tr><td class="h">406</td><td colspan="6"></td></tr><tr><td class="h">407</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Check for matching interfaces.</td></tr>
<tr><td class="h">408</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>143</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;checkinterfaces($conf, $spoc, $has_mpls);</td></tr>
<tr><td class="h">409</td><td colspan="6"></td></tr><tr><td class="h">410</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# *** BEGIN TRANSFER ***</td></tr>
<tr><td class="h">411</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>120</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;process_interface_acls($conf, $spoc);</td></tr>
<tr><td class="h">412</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>141</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;process_routing($conf, $spoc);</td></tr>
<tr><td class="h">413</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">414</td><td colspan="6"></td></tr><tr><td class="h">415</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
